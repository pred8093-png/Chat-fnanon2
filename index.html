index.html
index.html
<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙÙ‘Ø±Ø© â€” ÙØ¶Ø§Ø¡ØŒ Ù…ÙˆØ³ÙŠÙ‚Ù‰ØŒ Ø­Ø¨</title>
  <style>
    :root{
      --bg: radial-gradient(circle at 20% 20%, #0f0c29, #302b63, #24243e);
      --card: rgba(255,255,255,0.05);
      --accent: #ff6ec7;
      --accent2: #06b6d4;
      --muted: #b8b8d1;
      --text: #ffffff;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: 'Cairo', system-ui, Arial;
      direction:rtl;
      background: var(--bg);
      color:var(--text);
      background-attachment: fixed;
      animation: bgMove 30s infinite alternate ease-in-out;
    }
    @keyframes bgMove {
      0% {background-position: 0 0;}
      100% {background-position: 100% 100%;}
    }
    .container{max-width:980px;margin:20px auto;padding:16px}
    .card{
      background: var(--card);
      backdrop-filter: blur(12px);
      border-radius:20px;
      padding:20px;
      box-shadow: 0 0 30px rgba(255,110,199,0.2);
    }
    h1{
      margin:0 0 8px;
      font-size:22px;
      background: linear-gradient(90deg,var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align:center;
    }
    p{text-align:center;margin-bottom:14px;color:var(--muted)}
    .chat{
      height:360px;overflow:auto;border-radius:12px;padding:12px;
      background: rgba(0,0,0,0.3);
      border:1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(6px);
    }
    .bubble{
      margin:6px 0;padding:10px 12px;border-radius:12px;max-width:75%;word-break:break-word;
      box-shadow: 0 0 10px rgba(255,255,255,0.05);
    }
    .me{
      background: linear-gradient(90deg,#ff6ec7,#ff9a9e);
      margin-left:auto;
    }
    .them{
      background: linear-gradient(90deg,#06b6d4,#4facfe);
      margin-right:auto;
    }
    .meta{font-size:12px;color:var(--muted);margin-bottom:4px}
    input,textarea,select,button{
      width:100%;box-sizing:border-box;background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      padding:10px;border-radius:8px;color:var(--text);font-size:14px;
    }
    button{
      cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));
      border:0;color:#fff;font-weight:600;
      box-shadow: 0 0 12px rgba(255,110,199,0.4);
    }
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    footer{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}
    @media(max-width:720px){
      .container{padding:10px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ’« Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙÙ‘Ø±Ø© â€” ÙØ¶Ø§Ø¡ Ã— Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ã— Ø­Ø¨ ğŸ’–</h1>
      <p>Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø¢Ù…Ù† Ù„Ù„Ø¨ÙˆØ­ ØªØ­Øª Ù†Ø¬ÙˆÙ… Ø§Ù„ÙØ¶Ø§Ø¡ ÙˆØ¥ÙŠÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙˆÙ†Ø¨Ø¶ Ø§Ù„Ø­Ø¨.</p>
      <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ (HTML + JS) ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
    </div>
  </div>
</body>
</html>index.html
<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙÙ‘Ø±Ø© â€” ÙØ¶Ø§Ø¡ØŒ Ù…ÙˆØ³ÙŠÙ‚Ù‰ØŒ Ø­Ø¨</title>
  <style>
    :root{
      --bg: radial-gradient(circle at 20% 20%, #0f0c29, #302b63, #24243e);
      --card: rgba(255,255,255,0.05);
      --accent: #ff6ec7;
      --accent2: #06b6d4;
      --muted: #b8b8d1;
      --text: #ffffff;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: 'Cairo', system-ui, Arial;
      direction:rtl;
      background: var(--bg);
      color:var(--text);
      background-attachment: fixed;
      animation: bgMove 30s infinite alternate ease-in-out;
    }
    @keyframes bgMove {
      0% {background-position: 0 0;}
      100% {background-position: 100% 100%;}
    }
    .container{max-width:980px;margin:20px auto;padding:16px}
    .card{
      background: var(--card);
      backdrop-filter: blur(12px);
      border-radius:20px;
      padding:20px;
      box-shadow: 0 0 30px rgba(255,110,199,0.2);
    }
    h1{
      margin:0 0 8px;
      font-size:22px;
      background: linear-gradient(90deg,var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-align:center;
    }
    p{text-align:center;margin-bottom:14px;color:var(--muted)}
    .chat{
      height:360px;overflow:auto;border-radius:12px;padding:12px;
      background: rgba(0,0,0,0.3);
      border:1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(6px);
    }
    .bubble{
      margin:6px 0;padding:10px 12px;border-radius:12px;max-width:75%;word-break:break-word;
      box-shadow: 0 0 10px rgba(255,255,255,0.05);
    }
    .me{
      background: linear-gradient(90deg,#ff6ec7,#ff9a9e);
      margin-left:auto;
    }
    .them{
      background: linear-gradient(90deg,#06b6d4,#4facfe);
      margin-right:auto;
    }
    .meta{font-size:12px;color:var(--muted);margin-bottom:4px}
    input,textarea,select,button{
      width:100%;box-sizing:border-box;background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      padding:10px;border-radius:8px;color:var(--text);font-size:14px;
    }
    button{
      cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent2));
      border:0;color:#fff;font-weight:600;
      box-shadow: 0 0 12px rgba(255,110,199,0.4);
    }
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    footer{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}
    @media(max-width:720px){
      .container{padding:10px}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ’« Ø¯Ø±Ø¯Ø´Ø© Ù…Ø´ÙÙ‘Ø±Ø© â€” ÙØ¶Ø§Ø¡ Ã— Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ã— Ø­Ø¨ ğŸ’–</h1>
      <p>Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø¢Ù…Ù† Ù„Ù„Ø¨ÙˆØ­ ØªØ­Øª Ù†Ø¬ÙˆÙ… Ø§Ù„ÙØ¶Ø§Ø¡ ÙˆØ¥ÙŠÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙˆÙ†Ø¨Ø¶ Ø§Ù„Ø­Ø¨.</p>
      <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ (HTML + JS) ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
    </div>
  </div>
</body>
</html>
Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: Ø£Ø²Ø±Ø§Ø± Ø£ÙƒØ¨Ø±ØŒ Ù†Ø³Ø®/Ù„ØµÙ‚ Ø§Ø­ØªÙŠØ§Ø·ÙŠØŒ ÙˆØ±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø©.</p>

      <div style="display:grid;gap:12px;margin-top:12px">
        <div class="row">
          <div class="col">
            <label>Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="nick" placeholder="Ø§Ø³Ù… Ù…Ø«Ù„: Ø²Ø§Ø¦Ø± Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§" />
          </div>
          <div style="width:140px">
            <label>Ø§Ø¨Ù‚Ù Ù…ØªØ®ÙÙŠØ§Ù‹</label>
            <select id="anon">
              <option value="false">Ø¸Ø§Ù‡Ø±</option>
              <option value="true" selected>Ù…ØªØ®ÙÙ‘Ù</option>
            </select>
          </div>
        </div>

        <div>
          <label>Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© (Ù…ÙØªØ§Ø­)</label>
          <input id="passphrase" placeholder="Ø¬Ù…Ù„Ø© Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø³Ø± Ù…Ø´ØªØ±ÙƒØ©" />
          <div class="note">ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙØªØ§Ø­ AES Ø¹Ø¨Ø± PBKDF2. Ø´Ø§Ø±ÙƒÙ‡ Ø®Ø§Ø±Ø¬ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹.</div>
        </div>

        <div class="row">
          <div class="col">
            <label>Ø¥Ù†Ø´Ø§Ø¡ Offer â€” Ø§Ù†Ø³Ø®Ù‡ ÙˆØ§Ø¨Ø¹Ø«Ù‡ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±</label>
            <textarea id="localSignal" readonly></textarea>
            <div class="controls" style="margin-top:8px">
              <button id="createOffer" class="largeBtn">Ø¥Ù†Ø´Ø§Ø¡ Offer</button>
              <button id="copyOffer" class="muted-btn">Ù†Ø³Ø®</button>
            </div>
          </div>

          <div class="col">
            <label>Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ Ø§Ù„Ø¹Ø±Ø¶/Ø§Ù„Ø¬ÙˆØ§Ø¨ Ù…Ù† Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±</label>
            <textarea id="remoteSignal" placeholder="Ø§Ù„ØµÙ‚ Offer Ø£Ùˆ Answer Ù‡Ù†Ø§"></textarea>
            <div class="controls" style="margin-top:8px">
              <button id="acceptSignal" class="largeBtn">Ù‚Ø¨ÙˆÙ„</button>
              <button id="pasteRemote" class="muted-btn">Ù„ØµÙ‚</button>
            </div>
          </div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <div style="flex:1">
            <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</label>
            <input id="status" readonly value="ØºÙŠØ± Ù…ØªØµÙ„" />
          </div>
          <div style="width:200px">
            <label>ØªØ´ÙÙŠØ±</label>
            <input id="encStatus" readonly value="ØºÙŠØ± Ù…Ù‡ÙŠØ£" />
          </div>
        </div>

        <div class="chat" id="chat"></div>

        <div class="foot" style="display:flex;gap:8px;margin-top:8px">
          <input id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
          <button id="send" class="largeBtn">Ø¥Ø±Ø³Ø§Ù„</button>
          <button id="clear" class="muted-btn">Ù…Ø³Ø­</button>
        </div>

        <div class="note">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ù…Ù„:
          <ol style="margin:6px 0 0 18px;color:var(--muted)">
            <li>Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²ÙŠÙ† Ø£Ùˆ Ø´Ø§Ø±ÙƒÙ‡ Ø¹Ø¨Ø± GitHub Pages.</li>
            <li>Ø®Ù„Ù‚ Offer ÙˆÙ†Ø³Ø®Ù‡ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±ØŒ Ø«Ù… Ø§ÙƒÙ…Ù„ ØªØ¨Ø§Ø¯Ù„ Offer/Answer.</li>
            <li>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© Ù†ÙØ³Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙÙŠÙ† Ø«Ù… Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.</li>
          </ol>
        </div>
      </div>

      <footer>ØµÙÙ…Ù… Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙˆØ§Ù„Ø³Ù‡ÙˆÙ„Ø© Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù„Ù…Ø³ â€” ØªÙ…ÙƒÙŠÙ† WebRTC ÙˆClipboard Ù…Ø·Ù„ÙˆØ¨Ø§Ù†.</footer>
    </div>
  </div>

<script>
// Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø© Ù„Ø§Ø³ØªØ®Ø¯Ù…Ø§Øª Ø§Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯: Ø¯Ø¹Ù… Clipboard Ø§Ø­ØªÙŠØ§Ø·ÙŠØŒ Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ Ø£ÙˆØ¶Ø­
let pc, dc; let aesKey = null;
const localSignal = document.getElementById('localSignal');
const remoteSignal = document.getElementById('remoteSignal');
const createOfferBtn = document.getElementById('createOffer');
const acceptSignalBtn = document.getElementById('acceptSignal');
const copyOfferBtn = document.getElementById('copyOffer');
const pasteRemoteBtn = document.getElementById('pasteRemote');
const status = document.getElementById('status');
const encStatus = document.getElementById('encStatus');
const chat = document.getElementById('chat');
const sendBtn = document.getElementById('send');
const messageInput = document.getElementById('message');
const clearBtn = document.getElementById('clear');
const passphraseInput = document.getElementById('passphrase');

function logBubble(text,who='them'){
  const b = document.createElement('div');
  b.className = 'bubble '+(who==='me'?'me':'them');
  const meta = document.createElement('div'); meta.className='meta';
  meta.textContent = who==='me' ? (document.getElementById('nick').value||'Ù…ØªØ®ÙÙ') : 'Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±';
  b.appendChild(meta);
  const t = document.createElement('div'); t.textContent = text; b.appendChild(t);
  chat.appendChild(b);
  chat.scrollTop = chat.scrollHeight;
}

function setStatus(s){ status.value = s }
function setEnc(s){ encStatus.value = s }

// Clipboard helper: ÙŠØ­Ø§ÙˆÙ„ API Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŒ ÙˆØ¥Ø°Ø§ ÙØ´Ù„ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø­ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
async function writeClipboard(text){
  try{ await navigator.clipboard.writeText(text); return true; }
  catch(e){
    // fallback: create temporary textarea and execCommand (works Ø¹Ù„Ù‰ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
    try{
      const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta);
      ta.select(); ta.setSelectionRange(0, ta.value.length);
      const ok = document.execCommand('copy'); document.body.removeChild(ta); return ok;
    }catch(err){ console.warn('clipboard fallback failed', err); return false; }
  }
}

async function readClipboard(){
  try{ return await navigator.clipboard.readText(); }
  catch(e){
    // Ù„Ø§ ÙŠÙˆØ¬Ø¯ fallback Ø¢Ù…Ù† Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø© ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª
    return '';
  }
}

async function deriveKey(pass){
  setEnc('Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...');
  const enc = new TextEncoder().encode(pass);
  const salt = new TextEncoder().encode('chat-salt-v1');
  const baseKey = await crypto.subtle.importKey('raw', enc, 'PBKDF2', false, ['deriveKey']);
  const key = await crypto.subtle.deriveKey({name:'PBKDF2',salt:salt,iterations:100000,hash:'SHA-256'}, baseKey, {name:'AES-GCM',length:256}, false, ['encrypt','decrypt']);
  setEnc('Ù…ÙÙ‡ÙŠØ£');
  return key;
}

function setupPeer(isOffer){
  pc = new RTCPeerConnection({iceServers:[{urls:['stun:stun.l.google.com:19302']}]});
  pc.oniceconnectionstatechange = ()=> setStatus(pc.iceConnectionState);
  pc.onicecandidate = e => { if(!e.candidate) localSignal.value = JSON.stringify(pc.localDescription); }
  pc.ondatachannel = e=>{ dc = e.channel; initDC(); }
  if(isOffer){ dc = pc.createDataChannel('chat'); initDC(); }
}

function initDC(){
  dc.onopen = ()=> setStatus('Ù‚Ù†Ø§Ø© Ù…ÙØªÙˆØ­Ø©');
  dc.onclose = ()=> setStatus('Ù…ØºÙ„Ù‚Ø©');
  dc.onmessage = async (e)=>{
    try{
      const obj = JSON.parse(e.data);
      if(obj.type==='msg'){
        const plaintext = await decryptMessage(obj.payload);
        logBubble(plaintext,'them');
      }
    }catch(err){console.error(err)}
  }
}

async function encryptMessage(text){ if(!aesKey) throw new Error('Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ´ÙÙŠØ± ØºÙŠØ± Ù…ÙÙ‡ÙŠØ£');
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const enc = new TextEncoder().encode(text);
  const ct = await crypto.subtle.encrypt({name:'AES-GCM',iv}, aesKey, enc);
  return JSON.stringify({iv:Array.from(iv),ct:Array.from(new Uint8Array(ct))});
}

async function decryptMessage(payload){ if(!aesKey) throw new Error('Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ´ÙÙŠØ± ØºÙŠØ± Ù…ÙÙ‡ÙŠØ£');
  const obj = payload;
  const iv = new Uint8Array(obj.iv);
  const ct = new Uint8Array(obj.ct);
  const plain = await crypto.subtle.decrypt({name:'AES-GCM',iv}, aesKey, ct);
  return new TextDecoder().decode(plain);
}

createOfferBtn.onclick = async ()=>{
  try{
    setupPeer(true);
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    setStatus('Ø§Ù†Ø´Ø§Ø¡ Offer...');
  }catch(err){ alert('Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Offer: '+err.message) }
}

acceptSignalBtn.onclick = async ()=>{
  const text = remoteSignal.value.trim(); if(!text) return alert('Ø£Ù„ØµÙ‚ Ø§Ù„Ø¹Ø±Ø¶ Ø£Ùˆ Ø§Ù„Ø¬ÙˆØ§Ø¨ Ø£ÙˆÙ„Ø§Ù‹');
  let obj; try{ obj = JSON.parse(text); }catch(e){ return alert('Ù†Øµ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ØºÙŠØ± ØµØ§Ù„Ø­ JSON'); }
  if(obj.type === 'offer'){
    try{
      setupPeer(false);
      await pc.setRemoteDescription(obj);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      localSignal.value = JSON.stringify(pc.localDescription);
      setStatus('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Answer â€” Ø£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø£ÙˆÙ„');
    }catch(err){ alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¹Ø±Ø¶: '+err.message) }
  } else if(obj.type === 'answer'){
    try{ if(!pc) setupPeer(true); await pc.setRemoteDescription(obj); setStatus('Answer Ù…Ù‚Ø¨ÙˆÙ„ â€” ÙÙŠ Ø¥Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù‚Ù†Ø§Ø©'); }
    catch(err){ alert('ÙØ´Ù„ Ù‚Ø¨ÙˆÙ„ Answer: '+err.message) }
  } else { alert('Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'); }
}

copyOfferBtn.onclick = async ()=>{
  if(!localSignal.value) return alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ø±Ø¶ Ù„Ù„Ù†Ø³Ø®');
  const ok = await writeClipboard(localSignal.value);
  if(ok) alert('Ù†ÙØ³Ø® Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©'); else alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® â€” Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠØ§Ù‹');
}

pasteRemoteBtn.onclick = async ()=>{
  const txt = await readClipboard();
  if(txt) remoteSignal.value = txt; else alert('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø­Ø§ÙØ¸Ø© â€” Ø§Ù„ØµÙ‚ ÙŠØ¯ÙˆÙŠØ§Ù‹');
}

sendBtn.onclick = async ()=>{
  const txt = messageInput.value.trim(); if(!txt) return;
  if(!dc || dc.readyState!=='open') return alert('Ø§Ù„Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…ÙØªÙˆØ­Ø©');
  try{
    if(!aesKey){ const pass = passphraseInput.value; if(!pass) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©'); aesKey = await deriveKey(pass); }
    const encrypted = await encryptMessage(txt);
    dc.send(JSON.stringify({type:'msg',payload:JSON.parse(encrypted)}));
    logBubble(txt,'me'); messageInput.value = '';
  }catch(err){ alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: '+err.message); console.error(err) }
}

clearBtn.onclick = ()=>{ chat.innerHTML=''; }
messageInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); sendBtn.click(); } });

// ÙØ­Øµ Ù…Ø¨Ø³Ù‘Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø¸Ù‡ÙˆØ± Ø±Ø³Ø§Ø¦Ù„ ØªÙˆØ¶ÙŠØ­ÙŠØ© Ù„Ù„Ø£Ù†Ø¯Ø±ÙˆÙŠØ¯
window.addEventListener('load', ()=>{
  // ØªØ£ÙƒØ¯ Ù…Ù† Ø¯Ø¹Ù… WebRTC
  if(!window.RTCPeerConnection){ setStatus('WebRTC ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­'); }
  // ØªÙˆØ¶ÙŠØ­ Ù„Clipboard
  if(!navigator.clipboard){ console.warn('Clipboard API ØºÙŠØ± Ù…ØªØ§Ø­'); }
});
</script>

</body>
</html>
