<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="login-screen" class="screen">
        <h2>Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ</h2>
        <input type="text" id="username" placeholder="Ø§Ø³Ù…Ùƒ">
        <h3>Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø©</h3>
        <div id="channels"></div>
        <input type="password" id="channel-password" placeholder="Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù‚Ù†Ø§Ø© (Ø¥Ù† ÙˆØ¬Ø¯)">
        <button id="join-btn">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="chat-screen" class="screen hidden">
        <div class="chat-header">
            <h2 id="room-name"></h2>
            <button id="music-btn">ðŸŽµ</button>
        </div>
        <div id="messages"></div>
        <input type="text" id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...">
        <button id="send-btn">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>

    <audio id="bg-music" loop>
        <source src="sounds/lounge.mp3" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        let username = "";
        let currentRoom = "";

        socket.on("channelsList", (channels) => {
            const channelsDiv = document.getElementById("channels");
            channelsDiv.innerHTML = "";
            channels.forEach(ch => {
                const btn = document.createElement("button");
                btn.textContent = ch.name + (ch.protected ? " ðŸ”’" : "");
                btn.onclick = () => {
                    document.getElementById("channel-password").value = "";
                    document.getElementById("join-btn").onclick = () => joinRoom(ch.name);
                };
                channelsDiv.appendChild(btn);
            });
        });

        function joinRoom(room) {
            username = document.getElementById("username").value.trim();
            const password = document.getElementById("channel-password").value;
            if (!username) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
            socket.emit("joinRoom", { room, username, password });
        }

        socket.on("joinSuccess", (room) => {
            currentRoom = room;
            document.getElementById("room-name").textContent = "ðŸ“¡ " + room;
            document.getElementById("login-screen").classList.add("hidden");
            document.getElementById("chat-screen").classList.remove("hidden");
            document.getElementById("bg-music").play();
        });

        socket.on("joinError", (msg) => alert(msg));

        socket.on("message", (msg) => {
            const div = document.createElement("div");
            div.textContent = msg;
            document.getElementById("messages").appendChild(div);
        });

        document.getElementById("send-btn").onclick = () => {
            const text = document.getElementById("message-input").value.trim();
            if (text) {
                socket.emit("chatMessage", { room: currentRoom, username, text });
                document.getElementById("message-input").value = "";
            }
        };

        document.getElementById("music-btn").onclick = () => {
            const music = document.getElementById("bg-music");
            if (music.paused) music.play();
            else music.pause();
        };
    </script>
</body>
</html>
